name: $(date:yyyyMMdd)$(rev:.r)

trigger:
  branches:
    include:
    - main
  batch: True

pr:
  branches:
    include:
      - main
  paths:
    include:
      - code
    exclude:
      - code\TemplateStudioForWinUICs
      - code\src\ProjectTemplates\WinUI\Cs
      - code\test\TemplateStudioForWinUICs.Tests
      - code\TemplateStudioForWinUICpp
      - code\src\ProjectTemplates\WinUI\Cpp
      - code\test\TemplateStudioForWinUICpp.Tests
      - code\TemplateStudioForWPF
      - code\src\ProjectTemplates\WPF
      - code\test\TemplateStudioForWPF.Tests
      - code\TemplateStudioForUWP
      - code\src\ProjectTemplates\UWP
      - code\test\TemplateStudioForUWP.Tests

resources:
  repositories:
  - repository: self
    type: git
    ref: refs/heads/main

variables:
- name: NUGET.PLUGIN.HANDSHAKE.TIMEOUT.IN.SECONDS
  value: 20
- name: NUGET.PLUGIN.REQUEST.TIMEOUT.IN.SECONDS
  value: 20

jobs:
- template: templates/ci-build.yml
  parameters:
    Moniker: WinUICs
    BuildConfiguration: ReleaseWinUICs
    BuildPlatform: Any CPU

- template: templates/ci-test.yml
  parameters:
    Moniker: WinUICs
    BuildConfiguration: DebugWinUICs
    BuildPlatform: Any CPU

- template: templates/ci-build.yml
  parameters:
    Moniker: WinUICpp
    BuildConfiguration: ReleaseWinUICpp
    BuildPlatform: Any CPU

- template: templates/ci-test.yml
  parameters:
    Moniker: WinUICpp
    BuildConfiguration: DebugWinUICpp
    BuildPlatform: Any CPU
    
- template: templates/ci-build.yml
  parameters:
    Moniker: WPF
    BuildConfiguration: ReleaseWPF
    BuildPlatform: Any CPU

- template: templates/ci-test.yml
  parameters:
    Moniker: WPF
    BuildConfiguration: DebugWPF
    BuildPlatform: Any CPU
    
- template: templates/ci-build.yml
  parameters:
    Moniker: UWP
    BuildConfiguration: ReleaseUWP
    BuildPlatform: Any CPU

- template: templates/ci-test.yml
  parameters:
    Moniker: UWP
    BuildConfiguration: DebugUWP
    BuildPlatform: Any CPU